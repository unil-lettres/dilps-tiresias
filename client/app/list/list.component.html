<mat-menu #dilpsSortingMenu="matMenu" [overlapTrigger]="false">
    <div (click)="sorting([{active: CardSortingField.creationDate, direction: 'desc'}])" mat-menu-item>
        Date d'insertion en tête
    </div>
    <div (click)="sorting([{active: CardSortingField.updateDate, direction: 'desc'}])" mat-menu-item>
        Date de dernière édition en tête
    </div>
    <div
        (click)="sorting([{active: CardSortingField.plainName, direction: 'asc', emptyStringAsHighest: true}])"
        mat-menu-item
    >
        Titre
    </div>
    <div
        (click)="sorting([{active: CardSortingField.artists, direction: 'asc'}])"
        mat-menu-item
        *ngIf="site === Site.dilps"
    >
        Artistes
    </div>
    <div
        (click)="sorting([{active: CardSortingField.dating, direction: 'asc', emptyStringAsHighest: true}])"
        mat-menu-item
    >
        Datation
    </div>
    <div
        (click)="sorting([{active: CardSortingField.dilpsDomain, direction: 'asc', emptyStringAsHighest: true}])"
        mat-menu-item
    >
        Domaine
    </div>
    <div (click)="sorting([{active: CardSortingField.institutionLocality, direction: 'asc'}])" mat-menu-item>Lieu</div>
</mat-menu>
<mat-menu #tiresiasSortingMenu="matMenu" [overlapTrigger]="false">
    <div
        (click)="sorting([{active: CardSortingField.plainName, direction: 'asc', emptyStringAsHighest: true}])"
        mat-menu-item
    >
        Titre
    </div>
    <div (click)="sorting([{active: CardSortingField.creationDate, direction: 'desc'}])" mat-menu-item>
        Date d'insertion
    </div>
    <div (click)="sorting([{active: CardSortingField.updateDate, direction: 'desc'}])" mat-menu-item>
        Date de dernière édition
    </div>
    <div
        (click)="sorting([{active: CardSortingField.dating, direction: 'asc', emptyStringAsHighest: true}])"
        mat-menu-item
    >
        Datation
    </div>
    <div (click)="sorting([{active: CardSortingField.institutionLocality, direction: 'asc'}])" mat-menu-item>Lieu</div>
    <div
        (click)="sorting([{active: CardSortingField.dilpsDomain, direction: 'asc', emptyStringAsHighest: true}])"
        mat-menu-item
    >
        Domaine
    </div>
    <div
        *ngIf="site === Site.tiresias"
        (click)="sorting([{active: CardSortingField.documentType, direction: 'asc'}])"
        mat-menu-item
    >
        Type de document
    </div>
    <div (click)="sorting([{active: CardSortingField.code, direction: 'asc', nullAsHighest: true}])" mat-menu-item>
        Référence
    </div>
</mat-menu>

<div *ngIf="dataSource" class="containerWithToolbar" fxFlex fxLayout="column">
    <mat-toolbar fxFlex="none" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
        <app-logo *ngIf="showLogo" [data]="{type: 'toolbar', class: 'logo'}"></app-logo>

        <ng-container *ngIf="selected?.length">
            <button
                (click)="linkSelectionToCollection(selected)"
                *ngIf="!!user"
                mat-icon-button
                matTooltip="Ajouter ou retirer d'une collection"
            >
                <mat-icon naturalIcon="library_add"></mat-icon>
            </button>
            <button
                (click)="unlinkFromCollection(selected)"
                *ngIf="collection?.id"
                mat-icon-button
                matTooltip="Supprimer de la collection"
            >
                <mat-icon svgIcon="library_remove"></mat-icon>
            </button>

            <button (click)="downloadSelection(selected)" mat-icon-button matTooltip="Exporter">
                <mat-icon naturalIcon="share_windows"></mat-icon>
            </button>

            <button (click)="edit(selected)" *ngIf="canMassEdit()" mat-icon-button matTooltip="Editer en masse">
                <mat-icon naturalIcon="edit"></mat-icon>
            </button>

            <button
                (click)="delete(selected)"
                *ngIf="user?.role === 'administrator'"
                color="warn"
                mat-icon-button
                matTooltip="Supprimer la fiche définitivement"
            >
                <mat-icon naturalIcon="delete_forever"></mat-icon>
            </button>
        </ng-container>

        <ng-container *ngIf="!selected?.length && user">
            <button
                (click)="linkCollectionToCollection(collection!)"
                *ngIf="collection?.id"
                mat-icon-button
                matTooltip="Ajouter la collection à une autre collection"
            >
                <mat-icon naturalIcon="library_add"></mat-icon>
            </button>

            <button
                (click)="downloadCollection(collection!)"
                *ngIf="showDownloadCollection"
                mat-icon-button
                matTooltip="Exporter la collection"
            >
                <mat-icon naturalIcon="share_windows"></mat-icon>
            </button>
        </ng-container>

        <natural-search
            (selectionChange)="search($event)"
            [facets]="naturalSearchFacets"
            [selections]="naturalSearchSelections"
            dropdownTitle="Recherche approfondie"
            class="searchField"
            fxFlex
            fxFlexAlign="start"
        />

        <button
            (click)="setViewMode(ViewMode.grid)"
            *ngIf="viewMode !== ViewMode.grid"
            mat-icon-button
            matTooltip="Affichage Mosaïque"
        >
            <mat-icon naturalIcon="view_compact"></mat-icon>
        </button>

        <button
            (click)="setViewMode(ViewMode.list)"
            *ngIf="viewMode !== ViewMode.list"
            mat-icon-button
            matTooltip="Affichage Liste"
        >
            <mat-icon naturalIcon="view_list"></mat-icon>
        </button>

        <button
            (click)="setViewMode(ViewMode.map)"
            *ngIf="site === Site.tiresias && selected?.length && viewMode !== ViewMode.map"
            mat-icon-button
            matTooltip="Affichage Carte"
        >
            <mat-icon naturalIcon="map"></mat-icon>
        </button>

        <button
            [matMenuTriggerFor]="site === Site.dilps ? dilpsSortingMenu : tiresiasSortingMenu"
            mat-icon-button
            matTooltip="Trier"
        >
            <mat-icon svgIcon="sort_asc"></mat-icon>
        </button>

        <button
            *ngIf="viewMode === ViewMode.grid"
            (click)="toggleLabels()"
            mat-icon-button
            [matTooltip]="showLabels ? 'Masquer les légendes' : 'Afficher les légendes'"
        >
            <mat-icon *ngIf="!showLabels" naturalIcon="font_download"></mat-icon>
            <mat-icon *ngIf="showLabels" naturalIcon="font_download_off"></mat-icon>
        </button>

        <button (click)="unselectAll()" *ngIf="selected?.length" mat-icon-button matTooltip="Désélectionner tout">
            <mat-icon naturalIcon="deselect"></mat-icon>
        </button>

        <button
            (click)="selectAll()"
            *ngIf="!selected?.length"
            mat-icon-button
            matTooltip="Sélectionner les images visibles"
        >
            <mat-icon svgIcon="select_all_mark"></mat-icon>
        </button>

        <ng-container *ngIf="selected?.length">
            <button
                (click)="goToQuizz(selected)"
                *ngIf="!!user && site === Site.dilps"
                mat-icon-button
                matTooltip="Lecture d'oeuvre"
            >
                <mat-icon svgIcon="cards_game"></mat-icon>
            </button>
        </ng-container>

        <ng-container *ngIf="!selected?.length && user">
            <button *ngIf="site === Site.dilps" (click)="goToQuizz()" mat-icon-button matTooltip="Lecture d'oeuvre">
                <mat-icon svgIcon="cards_game"></mat-icon>
            </button>
        </ng-container>

        <div *ngIf="viewMode === ViewMode.grid">
            <mat-chip-set>
                <mat-chip>{{ gridNumberVisibleItems }}/{{ gridNumberTotalItems }}</mat-chip>
            </mat-chip-set>
        </div>
    </mat-toolbar>
    <div *ngIf="this.dataSource.data?.length === 0; else viewResults" class="empty-result">
        <div>
            <p>Aucun élément ne correspond aux termes recherchés.</p>
            <p>Essayez de :</p>
            <ul>
                <li>Vérifier l’orthographe, en cas de doute, écrire seulement une partie du mot.</li>
                <li>Simplifier la recherche.</li>
                <li>Enlever virgules, déterminants, prépositions, ...</li>
                <li>Utiliser la “Recherche approfondie“ pour préciser votre requête.</li>
            </ul>
        </div>
    </div>
    <ng-template #viewResults>
        <app-view-grid
            (pagination)="pagination($event)"
            (selectionChange)="select($event)"
            (contentChange)="gridContentChange($event)"
            *ngIf="viewMode === ViewMode.grid"
            [dataSource]="dataSource"
            [selected]="selected"
            [style.height]="'100%'"
        ></app-view-grid>

        <app-view-list
            (pagination)="pagination($event)"
            (selectionChange)="select($event)"
            *ngIf="viewMode === ViewMode.list"
            [dataSource]="dataSource"
            [selected]="selected"
            [style.height]="'100%'"
        ></app-view-list>

        <app-view-map
            *ngIf="viewMode === ViewMode.map"
            [cards]="selected"
            [style.height]="'100%'"
            (searchByLocation)="searchByLocation($event)"
        ></app-view-map>
    </ng-template>
</div>

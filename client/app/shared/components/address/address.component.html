<div [fxLayoutGap]="vertical ? '0px' : '10px'" fxLayout="column">
    <mat-form-field *ngIf="!readonly || !!model?.street">
        <mat-label>Rue</mat-label>
        <input (keyup.enter)="search()" [(ngModel)]="model!.street" [readonly]="readonly" matInput maxlength="255" />
        <mat-hint align="end" *ngIf="model?.street?.length > 200" [ngClass]="{strong: model!.street!.length >= 255}">
            {{ model!.street!.length }} / 255
        </mat-hint>
    </mat-form-field>

    <div [fxLayoutGap]="vertical ? '0px' : '10px'" [fxLayout]="vertical ? 'column' : 'row'">
        <mat-form-field *ngIf="isDilps && (!readonly || !!model?.postcode)">
            <mat-label>NPA</mat-label>
            <input
                (keyup.enter)="search()"
                [(ngModel)]="model!.postcode"
                [readonly]="readonly"
                matInput
                maxlength="20"
            />
            <mat-hint
                align="end"
                *ngIf="model?.postcode?.length > 15"
                [ngClass]="{strong: model!.postcode!.length >= 20}"
            >
                {{ model!.postcode!.length }} / 20
            </mat-hint>
        </mat-form-field>

        <mat-form-field *ngIf="!readonly || !!model?.locality" [fxFlex]="!vertical">
            <mat-label>Localité</mat-label>
            <input
                (keyup.enter)="search()"
                [(ngModel)]="model!.locality"
                [readonly]="readonly"
                matInput
                maxlength="191"
            />
            <mat-hint
                align="end"
                *ngIf="model?.locality?.length > 150"
                [ngClass]="{strong: model!.locality!.length >= 191}"
            >
                {{ model!.locality!.length }} / 191
            </mat-hint>
        </mat-form-field>

        <natural-select
            (keyup.enter)="search()"
            *ngIf="countries && (!readonly || !!model?.country)"
            [(ngModel)]="model!.country"
            [disabled]="readonly"
            [service]="countryService"
            [showIcon]="false"
            placeholder="Pays"
        ></natural-select>
    </div>
</div>

<div id="mapZone">
    <mat-form-field [fxShow]="(mapApiService.loaded | async) && !readonly" class="mat-elevation-z4" id="search">
        <mat-label>Chercher</mat-label>
        <input
            #input
            [formControl]="formCtrl"
            autocapitalize="off"
            autocorrect="off"
            class="form-control"
            matInput
            spellcheck="off"
        />
    </mat-form-field>

    <!-- Map -->
    <div
        class="wrapper-google-map"
        *ngIf="(mapApiService.loaded | async) && (!readonly || (!!model?.latitude && !!model?.longitude))"
    >
        <google-map
            [options]="mapOptions"
            [center]="{lat: latitude, lng: longitude}"
            [zoom]="zoom"
            height="450px"
            width="100%"
        >
            <map-marker
                (mapDragend)="onMarkerDrag($event)"
                [icon]="icon!"
                [position]="
                    (model?.latitude && model?.longitude ? {lat: model?.latitude, lng: model?.longitude} : null)!
                "
                [options]="{draggable: !readonly}"
            ></map-marker>
        </google-map>
    </div>
</div>

<div fxLayout="row" fxLayoutGap="10px" *ngIf="!isDilps">
    <mat-form-field *ngIf="!readonly || !!model?.latitude" class="lonlat">
        <mat-label>Latitude</mat-label>
        <input
            type="number"
            (ngModelChange)="recenter()"
            [(ngModel)]="model!.latitude"
            [readonly]="readonly"
            matInput
        />
    </mat-form-field>

    <mat-form-field *ngIf="!readonly || !!model?.longitude" class="lonlat">
        <mat-label>Longitude</mat-label>
        <input
            type="number"
            (ngModelChange)="recenter()"
            [(ngModel)]="model!.longitude"
            [readonly]="readonly"
            matInput
        />
    </mat-form-field>
</div>

<!-- Todo : allow to nullify --><!-- Todo : test this component suggestion system, that is new in project -->
<natural-select-enum
    *ngIf="!isDilps && (!readonly || !!model?.precision)"
    [(ngModel)]="model!.precision"
    enumName="Precision"
    placeholder="Précision"
    [disabled]="readonly"
></natural-select-enum>
